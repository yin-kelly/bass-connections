---
title: "Stims"
format: html
editor: visual
---
```{r}
#| label: load-pkgs
#| message: false
library(tidyverse)
library(ggplot2)
library(dplyr)
library(grid)
```


```{r}
#| label: load-data


coffee_data <- read_csv("datasets/coffee_consumption.csv")
recycling_data <- read_csv("datasets/durham_recycling.csv")
outdoors_data <- read_csv("datasets/nc_outdoor_survey.csv")
activity_data <- read_csv("datasets/physical_activity.csv")
sleep_data <- read_csv("datasets/screen_time_sleep.csv")
spotify_data <- read_csv("datasets/spotify_listening_habits.csv")

```

```{r}

#| label: lollipop-chart
create_lollipop_chart <- function(data, 
                                   category_col, 
                                   value_col,
                                   title,
                                   y_label,
                                   category_order = NULL,
                                   y_break_interval = 10,
                                   color = "steelblue",
                                   output_file = NULL) {

  plot_data <- data |>
    select(category = {{category_col}}, value = {{value_col}})

  if (!is.null(category_order)) {
    plot_data <- plot_data |>
      mutate(category = factor(category, levels = category_order))
  }

  ymax <- max(plot_data$value, na.rm = TRUE)
  yupper <- ceiling(ymax / y_break_interval) * y_break_interval

  p <- ggplot(plot_data, aes(x = category, y = value)) +
    geom_segment(aes(xend = category, yend = 0),
                 color = color, linewidth = 2.3) +
    geom_point(color = color, size = 9) +
    labs(title = title, x = NULL, y = NULL) +
    scale_y_continuous(
      limits = c(0, yupper),
      breaks = seq(0, yupper, by = y_break_interval),
      expand = expansion(mult = c(0, 0.05))
    ) +
    theme_classic() +
    theme(
      plot.title = element_text(
        size = 16, face = "bold",
        hjust = 0.5,
        margin = margin(t = -20, b = 60)
      ),
      plot.margin = margin(45, 40, 25, 40),
      axis.text = element_text(size = 14),
      axis.ticks.x = element_blank()
    ) +
    annotation_custom(
      grob = textGrob(y_label, gp = gpar(fontsize = 14)),
      ymin = yupper, ymax = yupper, xmin = 0.5, xmax = 0.5
    ) +
    coord_cartesian(clip = "off")

  gt <- ggplot_gtable(ggplot_build(p))
  gt$layout$clip[gt$layout$name == "panel"] <- "off"

  if (!is.null(output_file)) {
    ggsave(output_file, plot = gt, width = 8, height = 5)
  }

  grid.draw(gt)
}

```



```{r}
#| label: bar-chart
create_bar_chart <- function(data,
                             category_col,
                             value_col,
                             title,
                             y_label,
                             category_order = NULL,
                             y_break_interval = 10,
                             color = "steelblue",
                             output_file = NULL) {

  plot_data <- data |>
    select(category = {{category_col}}, value = {{value_col}})

  if (!is.null(category_order)) {
    plot_data <- plot_data |>
      mutate(category = factor(category, levels = category_order))
  }

  ymax <- max(plot_data$value, na.rm = TRUE)
  yupper <- ceiling(ymax / y_break_interval) * y_break_interval

  p <- ggplot(plot_data, aes(x = category, y = value)) +
    geom_col(fill = color, width = 0.7) +
    labs(title = title, x = NULL, y = NULL) +
    scale_y_continuous(
      limits = c(0, yupper),
      breaks = seq(0, yupper, by = y_break_interval),
      expand = expansion(mult = c(0, 0.05))
    ) +
    theme_classic() +
    theme(
      plot.title = element_text(
        size = 16, face = "bold",
        hjust = 0.5,
        margin = margin(t = -20, b = 60)
      ),
      plot.margin = margin(45, 40, 25, 40),
      axis.text = element_text(size = 14),
      axis.ticks.x = element_blank()
    ) +
    annotation_custom(
      grob = textGrob(y_label, gp = gpar(fontsize = 14)),
      ymin = yupper, ymax = yupper, xmin = 0.5, xmax = 0.5
    ) +
    coord_cartesian(clip = "off")

  gt <- ggplot_gtable(ggplot_build(p))
  gt$layout$clip[gt$layout$name == "panel"] <- "off"

  if (!is.null(output_file)) {
    ggsave(output_file, plot = gt, width = 8, height = 5)
  }

  grid.draw(gt)
}

```

```{r}
#| label: dot-plot
create_dot_plot <- function(data,
                            category_col,
                            value_col,
                            title,
                            y_label,
                            category_order = NULL,
                            y_break_interval = 1,
                            color = "steelblue",
                            output_file = NULL) {

  plot_data <- data |>
    select(category = {{category_col}}, value = {{value_col}})

  if (!is.null(category_order)) {
    plot_data <- plot_data |>
      mutate(category = factor(category, levels = category_order))
  }

  ymax <- max(plot_data$value, na.rm = TRUE)
  yupper <- ceiling(ymax / y_break_interval) * y_break_interval

  p <- ggplot(plot_data, aes(x = category, y = value)) +
    geom_point(color = color, size = 9) +
    labs(title = title, x = NULL, y = NULL) +
    scale_y_continuous(
      limits = c(0, yupper),
      breaks = seq(0, yupper, by = y_break_interval),
      expand = expansion(mult = c(0, 0.05))
    ) +
    theme_classic() +
    theme(
      plot.title = element_text(
        size = 16, face = "bold",
        hjust = 0.5,
        margin = margin(t = -20, b = 60)
      ),
      plot.margin = margin(45, 40, 25, 40),
      axis.text = element_text(size = 14),
      axis.ticks.x = element_blank()
    ) +
    annotation_custom(
      grob = textGrob(y_label, gp = gpar(fontsize = 14)),
      ymin = yupper, ymax = yupper, xmin = 0.5, xmax = 0.5
    ) +
    coord_cartesian(clip = "off")

  gt <- ggplot_gtable(ggplot_build(p))
  gt$layout$clip[gt$layout$name == "panel"] <- "off"

  if (!is.null(output_file)) {
    ggsave(output_file, plot = gt, width = 8, height = 5)
  }

  grid.draw(gt)
}

```

```{r}
#| label: coffee-stimuli

age_order <- c("18-24", "25-34", "35-44", "45-54", "55+")

create_bar_chart(
  data = coffee_data |> filter(Measure == "CupsPerDay"),
  category_col = AgeGroup,
  value_col = Value,
  title = "Avg. Cups of Coffee per Day by Age",
  y_label = "Avg. Cups\nper Day",
  category_order = age_order,
  y_break_interval = 0.5,
  color = "#4C6A92",
  output_file = "sam-stimuli-pngs/coffee_bar.png"
)

create_lollipop_chart(
  data = coffee_data |> filter(Measure == "PercentDrinkingBlack"),
  category_col = AgeGroup,
  value_col = Value,
  title = "Percent Who Drink Coffee Black by Age",
  y_label = "% Drinking\nBlack",
  category_order = age_order,
  y_break_interval = 10,
  color = "#4C6A92",
  output_file = "sam-stimuli-pngs/coffee_lollipop.png"
)

create_dot_plot(
  data = coffee_data |> filter(Measure == "MonthlySpending"),
  category_col = AgeGroup,
  value_col = Value,
  title = "Avg. Monthly Coffee Spending by Age",
  y_label = "Monthly\nDollars",
  category_order = age_order,
  y_break_interval = 5,
  color = "#4C6A92",
  output_file = "sam-stimuli-pngs/coffee_dot.png"
)

```


```{r}
#| label: activity-stimuli

region_order <- c("Northeast", "Midwest", "South", "West", "Mountain")

create_bar_chart(
  data = activity_data |> filter(Measure == "AvgDailySteps"),
  category_col = Location,
  value_col = Value,
  title = "Average Daily Steps by U.S. Region",
  y_label = "Steps\nper Day",
  category_order = region_order,
  y_break_interval = 2000,
  color = "#5C8A72",
  output_file = "sam-stimuli-pngs/activity_steps_bar.png"
)

create_lollipop_chart(
  data = activity_data |> filter(Measure == "PercentStrengthTraining"),
  category_col = Location,
  value_col = Value,
  title = "Percent Who Strength Train by U.S. Region",
  y_label = "% Who\nStrength Train",
  category_order = region_order,
  y_break_interval = 5,
  color = "#5C8A72",
  output_file = "sam-stimuli-pngs/activity_strength_lollipop.png"
)

create_dot_plot(
  data = activity_data |> filter(Measure == "SedentaryHours"),
  category_col = Location,
  value_col = Value,
  title = "Average Sedentary Hours per Day by U.S. Region",
  y_label = "Sedentary\nHours",
  category_order = region_order,
  y_break_interval = 0.5,
  color = "#5C8A72",
  output_file = "sam-stimuli-pngs/activity_sedentary_dot.png"
)


```


```{r}
#| label: spotify-stimuli

time_order <- c("Morning", "Afternoon", "Night")

create_bar_chart(
  data = spotify_data |> filter(Measure == "AvgListeningDuration"),
  category_col = TimeOfDay,
  value_col = Value,
  title = "Average Spotify Listening Duration by Time of Day",
  y_label = "Duration\n(minutes)",
  category_order = time_order,
  y_break_interval = 10,
  color = "#8A6F9E",
  output_file = "sam-stimuli-pngs/spotify_duration_bar.png"
)

create_lollipop_chart(
  data = spotify_data |> filter(Measure == "AvgSongTempo"),
  category_col = TimeOfDay,
  value_col = Value,
  title = "Average Song Tempo by Time of Day",
  y_label = "Tempo\n(BPM)",
  category_order = time_order,
  y_break_interval = 20,
  color = "#8A6F9E",
  output_file = "sam-stimuli-pngs/spotify_tempo_lollipop.png"
)

create_dot_plot(
  data = spotify_data |> filter(Measure == "AvgVolumeLevel"),
  category_col = TimeOfDay,
  value_col = Value,
  title = "Average Listening Volume by Time of Day",
  y_label = "Volume\n(dB)",
  category_order = time_order,
  y_break_interval = 10,
  color = "#8A6F9E",
  output_file = "sam-stimuli-pngs/spotify_volume_dot.png"
)

```



```{r}
#| label: screen-time-stimuli

phone_order <- c("0-1", "1-2", "2-3", "3+")

create_bar_chart(
  data = sleep_data |> filter(Measure == "AvgSleepDuration"),
  category_col = PhoneUseHours,
  value_col = Value,
  title = "Average Sleep Duration by Daily Phone Use",
  y_label = "Sleep Duration\n(hours)",
  category_order = phone_order,
  y_break_interval = 1,
  color = "#4E9F3D",
  output_file = "sam-stimuli-pngs/screen_sleep_duration_bar.png"
)

create_lollipop_chart(
  data = sleep_data |> filter(Measure == "AvgSleepQuality"),
  category_col = PhoneUseHours,
  value_col = Value,
  title = "Average Sleep Quality by Daily Phone Use",
  y_label = "Sleep Quality\n(score 1-10)",
  category_order = phone_order,
  y_break_interval = 1,
  color = "#4E9F3D",
  output_file = "sam-stimuli-pngs/screen_sleep_quality_lollipop.png"
)

create_dot_plot(
  data = sleep_data |> filter(Measure == "PercentFatigue"),
  category_col = PhoneUseHours,
  value_col = Value,
  title = "Percent Reporting Fatigue by Daily Phone Use",
  y_label = "Percent Fatigue\n(%)",
  category_order = phone_order,
  y_break_interval = 10,
  color = "#4E9F3D",
  output_file = "sam-stimuli-pngs/screen_fatigue_dot.png"
)

```


```{r}
#| label: outdoors-stimuli

temp_order <- c("<50", "50-70", "70-85", "85+")

create_bar_chart(
  data = outdoors_data |> filter(Measure == "AvgHoursOutside"),
  category_col = Temperature,
  value_col = Value,
  title = "Average Hours Spent Outside by Temperature",
  y_label = "Hours Outside",
  category_order = temp_order,
  y_break_interval = 1,
  color = "#2A9D8F",
  output_file = "sam-stimuli-pngs/outdoors_hours_bar.png"
)

create_lollipop_chart(
  data = outdoors_data |> filter(Measure == "AvgHoursWalking"),
  category_col = Temperature,
  value_col = Value,
  title = "Average Hours Walking by Temperature",
  y_label = "Hours Walking",
  category_order = temp_order,
  y_break_interval = 1,
  color = "#2A9D8F",
  output_file = "sam-stimuli-pngs/outdoors_walking_lollipop.png"
)

create_dot_plot(
  data = outdoors_data |> filter(Measure == "AvgOutings"),
  category_col = Temperature,
  value_col = Value,
  title = "Average Number of Outdoor Outings by Temperature",
  y_label = "Number of Outings",
  category_order = temp_order,
  y_break_interval = 1,
  color = "#2A9D8F",
  output_file = "sam-stimuli-pngs/outdoors_outings_dot.png"
)

```

