```{r}
#| label: load-pkgs
#| message: false
library(tidyverse)
library(ggplot2)
library(dplyr)
library(grid)
```

```{r}
#| label: load-data
social_media_data <- read_csv("datasets/social_media_data.csv")
streaming_data <- read_csv("datasets/streaming_data.csv")
travel_data <- read_csv("datasets/travel_data.csv")
transportation_data <- read_csv("datasets/transportation_data.csv")
gaming_data <- read_csv("datasets/gaming_data.csv")
meals_data <- read_csv("datasets/meals_data.csv")
```

## FUNCTIONS

```{r}
#| label: lollipop-chart

# TEMPLATE FUNCTION: LOLLIPOP CHART

create_lollipop_chart <- function(data, 
                                   category_col, 
                                   value_col,
                                   title,
                                   y_label,
                                   category_order = NULL,
                                   y_break_interval = 50,
                                   color = "steelblue",
                                   output_file = NULL) {
  
  # Prepare the data
  plot_data <- data |>
    select(category = {{category_col}}, value = {{value_col}})
  
  # Set category order if provided
  if (!is.null(category_order)) {
    plot_data <- plot_data |>
      mutate(category = factor(category, levels = category_order))
  }
  
  # Calculate y-axis upper limit
  ymax <- max(plot_data$value, na.rm = TRUE)
  yupper <- ceiling(ymax / y_break_interval) * y_break_interval
  
  # Create the plot
  p <- ggplot(plot_data, aes(x = category, y = value)) +
    geom_segment(aes(xend = category, yend = 0),
                 color = color, linewidth = 2.3) +
    geom_point(color = color, size = 9) +
    labs(
      title = title,
      x = NULL,
      y = NULL
    ) +
    scale_y_continuous(
      limits = c(0, yupper),
      breaks = seq(0, yupper, by = y_break_interval),
      expand = expansion(mult = c(0, 0.05))
    ) +
    theme_classic() +
    theme(
      plot.title = element_text(
        size = 16,
        face = "bold", 
        vjust = 1,
        hjust = 0.5, 
        lineheight = 1.2,
        margin = margin(t = -20, b = 60)  # Increased bottom margin for more space
      ),
      plot.margin = margin(45, 40, 25, 40),
      axis.text.x = element_text(size = 14, color = "black"),
      axis.text.y = element_text(size = 14, color = "black"),
      axis.ticks.x = element_blank(),
      axis.ticks.y = element_line(color = "black"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank()
    ) +
    #PROBLEMATIC CODE FOR CENTERING Y-AXIS TEXT
    annotation_custom(
      grob = textGrob(
        label = y_label, 
        hjust = 0.5,
        vjust = -0.9,  # Adjusted to position label with more space from title
        gp = gpar(fontsize = 14)
      ),
      ymin = yupper,
      ymax = yupper,
      xmin = 0.5,
      xmax = 0.5
    ) +
    coord_cartesian(clip = "off")
  
  # Build the plot and turn off clipping
  gt <- ggplot_gtable(ggplot_build(p))
  gt$layout$clip[gt$layout$name == "panel"] <- "off"
  
  # Save if output file specified
  if (!is.null(output_file)) {
    ggsave(output_file, plot = gt, device = "png", width = 8, height = 5)
  }
  
  # Draw and return
  grid.draw(gt)
  invisible(gt)
}
```

```{r}
#| label: bar-chart

# TEMPLATE FUNCTION: BAR CHART

create_bar_chart <- function(data, 
                              category_col, 
                              value_col,
                              title,
                              y_label,
                              category_order = NULL,
                              y_break_interval = 50,
                              color = "steelblue",
                              output_file = NULL) {
  
  # Prepare the data
  plot_data <- data |>
    select(category = {{category_col}}, value = {{value_col}})
  
  # Set category order if provided
  if (!is.null(category_order)) {
    plot_data <- plot_data |>
      mutate(category = factor(category, levels = category_order))
  }
  
  # Calculate y-axis upper limit
  ymax <- max(plot_data$value, na.rm = TRUE)
  yupper <- ceiling(ymax / y_break_interval) * y_break_interval
  
  # Create the plot
  p <- ggplot(plot_data, aes(x = category, y = value)) +
    geom_col(fill = color, width = 0.4) +
    labs(
      title = title,
      x = NULL,
      y = NULL
    ) +
    scale_y_continuous(
      limits = c(0, yupper),
      breaks = seq(0, yupper, by = y_break_interval),
      expand = expansion(mult = c(0, 0.05))
    ) +
    theme_classic() +
    theme(
      plot.title = element_text(
        size = 16,
        face = "bold", 
        vjust = 1,
        hjust = 0.5, 
        lineheight = 1.2,
        margin = margin(t = -20, b = 60)  # Increased bottom margin for more space
      ),
      plot.margin = margin(45, 40, 25, 40),
      axis.text.x = element_text(size = 14, color = "black"),
      axis.text.y = element_text(size = 14, color = "black"),
      axis.ticks.x = element_blank(),
      axis.ticks.y = element_line(color = "black"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank()
    ) +
    annotation_custom(
      grob = textGrob(
        label = y_label, 
        hjust = 0.5,
        vjust = -0.9,  # Adjusted to position label with more space from title
        gp = gpar(fontsize = 14)
      ),
      ymin = yupper,
      ymax = yupper,
      xmin = 0.5,
      xmax = 0.5
    ) +
    coord_cartesian(clip = "off")
  
  # Build the plot and turn off clipping
  gt <- ggplot_gtable(ggplot_build(p))
  gt$layout$clip[gt$layout$name == "panel"] <- "off"
  
  # Save if output file specified
  if (!is.null(output_file)) {
    ggsave(output_file, plot = gt, device = "png", width = 8, height = 5)
  }
  
  # Draw and return
  grid.draw(gt)
  invisible(gt)
}
```

```{r}
#| label: dot-plot

# TEMPLATE FUNCTION: DOT PLOT

create_dot_plot <- function(data, 
                             category_col, 
                             value_col,
                             title,
                             y_label,
                             category_order = NULL,
                             y_break_interval = 0.5,
                             color = "steelblue",
                             output_file = NULL) {
  
  # Prepare the data
  plot_data <- data |>
    select(category = {{category_col}}, value = {{value_col}})
  
  # Set category order if provided
  if (!is.null(category_order)) {
    plot_data <- plot_data |>
      mutate(category = factor(category, levels = category_order))
  }
  
  # Calculate y-axis upper limit
  ymax <- max(plot_data$value, na.rm = TRUE)
  yupper <- ceiling(ymax / y_break_interval) * y_break_interval
  
  # Create the plot
  p <- ggplot(plot_data, aes(x = category, y = value)) +
    geom_point(color = color, size = 9) +
    labs(
      title = title,
      x = NULL,
      y = NULL
    ) +
    scale_y_continuous(
      limits = c(0, yupper),
      breaks = seq(0, yupper, by = y_break_interval),
      expand = expansion(mult = c(0, 0.05))
    ) +
    theme_classic() +
    theme(
      plot.title = element_text(
        size = 16,
        face = "bold", 
        vjust = 1,
        hjust = 0.5, 
        lineheight = 1.2,
        margin = margin(t = -20, b = 60)  # Increased bottom margin for more space
      ),
      plot.margin = margin(45, 40, 25, 40),
      axis.text.x = element_text(size = 14, color = "black"),
      axis.text.y = element_text(size = 14, color = "black"),
      axis.ticks.x = element_blank(),
      axis.ticks.y = element_line(color = "black"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank()
    ) +
    annotation_custom(
      grob = textGrob(
        label = y_label, 
        hjust = 0.5,
        vjust = -0.9,  # Adjusted to position label with more space from title
        gp = gpar(fontsize = 14)
      ),
      ymin = yupper,
      ymax = yupper,
      xmin = 0.5,
      xmax = 0.5
    ) +
    coord_cartesian(clip = "off")
  
  # Build the plot and turn off clipping
  gt <- ggplot_gtable(ggplot_build(p))
  gt$layout$clip[gt$layout$name == "panel"] <- "off"
  
  # Save if output file specified
  if (!is.null(output_file)) {
    ggsave(output_file, plot = gt, device = "png", width = 8, height = 5)
  }
  
  # Draw and return
  grid.draw(gt)
  invisible(gt)
}
```

```{r}
#| label: social-media-stimuli
# Chart 1: Lollipop - Time per day
create_lollipop_chart(
  data = social_media_data,
  category_col = platform_type,
  value_col = time_per_day_minutes,
  title = "Average Daily Engagement Time\nby Social Media Platform Type",
  y_label = "Time\n(minutes)",
  y_break_interval = 20,
  color = "#355463",
  output_file = "kelly-stimuli-pngs/social_lollipop.png"
)

create_bar_chart(
  data = social_media_data,
  category_col = platform_type,
  value_col = time_per_day_minutes,
  title = "Average Daily Engagement Time\nby Social Media Platform Type",
  y_label = "Time\n(minutes)",
  y_break_interval = 20,
  color = "#355463",
  output_file = "kelly-stimuli-pngs/social_bar1.png"
)

# Chart 2: Bar - Posts per week
create_bar_chart(
  data = social_media_data,
  category_col = platform_type,
  value_col = posts_per_week,
  title = "Average Weekly Posts per User\nby Social Media Platform Type",
  y_label = "Posts per\nWeek",
  y_break_interval = 20,
  color = "#355463",
  output_file = "kelly-stimuli-pngs/social_bar.png"
)

# Chart 3: Dot - Followers
create_dot_plot(
  data = social_media_data,
  category_col = platform_type,
  value_col = connections,
  title = "Average Number of Followers per User\nby Social Media Platform Type",
  y_label = "Average Number\nof Followers",
  y_break_interval = 100,
  color = "#355463",
  output_file = "kelly-stimuli-pngs/social_dot.png"
)

create_bar_chart(
  data = social_media_data,
  category_col = platform_type,
  value_col = connections,
  title = "Average Number of Followers per User\nby Social Media Platform Type",
  y_label = "Number of\nFollowers",
  y_break_interval = 100,
  color = "#355463",
  output_file = "kelly-stimuli-pngs/social_bar3.png"
)
```

```{r}
#| label: streaming-stimuli
# Chart 1: Bar - Episodes per session
create_bar_chart(
  data = streaming_data,
  category_col = content_type,
  value_col = episodes_per_session,
  title = "Average Episodes Watched per Binge Session by Content Type",
  y_label = "Number of\nEpisodes",
  y_break_interval = 2,
  color = "#7D6B7D",
  output_file = "kelly-stimuli-pngs/streaming_bar.png"
)

# Chart 2: Dot - Total hours weekly
create_dot_plot(
  data = streaming_data,
  category_col = content_type,
  value_col = total_hours_weekly,
  title = "Average Weekly Viewing Hours by Content Type",
  y_label = "Hours per\nWeek",
  y_break_interval = 2,
  color = "#7D6B7D",
  output_file = "kelly-stimuli-pngs/streaming_dot.png"
)

create_bar_chart(
  data = streaming_data,
  category_col = content_type,
  value_col = total_hours_weekly,
  title = "Average Weekly Viewing Hours by Content Type",
  y_label = "Hours per\nWeek",
  y_break_interval = 2,
  color = "#7D6B7D",
  output_file = "kelly-stimuli-pngs/streaming_bar2.png"
)

# Chart 3: Lollipop - Days to finish series
create_lollipop_chart(
  data = streaming_data,
  category_col = content_type,
  value_col = days_to_finish_series,
  title = "Average Days to Complete a Series by Content Type",
  y_label = "Number of\nDays",
  y_break_interval = 2,
  color = "#7D6B7D",
  output_file = "kelly-stimuli-pngs/streaming_lollipop.png"
)

create_bar_chart(
  data = streaming_data,
  category_col = content_type,
  value_col = days_to_finish_series,
  title = "Average Days to Complete a Series by Content Type",
  y_label = "Number of\nDays",
  y_break_interval = 2,
  color = "#7D6B7D",
  output_file = "kelly-stimuli-pngs/streaming_bar3.png"
)
```

```{r}
#| label: travel-stimuli

# Chart 1: Bar - Planning hours
create_bar_chart(
  data = travel_data,
  category_col = travel_type,
  value_col = planning_hours,
  title = "Average Time Spent Planning by Vacation Type",
  y_label = "Number of\nhours",
  y_break_interval = 10,
  color = "#536345",
  output_file = "kelly-stimuli-pngs/travel_bar.png"
)

# Chart 2: Lollipop - Trip cost
create_lollipop_chart(
  data = travel_data,
  category_col = travel_type,
  value_col = trip_cost,
  title = "Average Trip Cost by Vacation Type",
  y_label = "Cost\n(Dollars)",
  y_break_interval = 500,
  color = "#536345",
  output_file = "kelly-stimuli-pngs/travel_lollipop.png"
)

create_bar_chart(
  data = travel_data,
  category_col = travel_type,
  value_col = trip_cost,
  title = "Average Trip Cost by Vacation Type",
  y_label = "Cost\n(Dollars)",
  y_break_interval = 500,
  color = "#536345",
  output_file = "kelly-stimuli-pngs/travel_bar2.png"
)

# Chart 3: Dot - Trip length
create_dot_plot(
  data = travel_data,
  category_col = travel_type,
  value_col = days_away,
  title = "Average Length of the Trip by Vacation Type",
  y_label = "Number of\ndays",
  y_break_interval = 2,
  color = "#536345",
  output_file = "kelly-stimuli-pngs/travel_dot.png"
)

create_bar_chart(
  data = travel_data,
  category_col = travel_type,
  value_col = days_away,
  title = "Average Length of the Trip by Vacation Type",
  y_label = "Number of\ndays",
  y_break_interval = 2,
  color = "#536345",
  output_file = "kelly-stimuli-pngs/travel_bar3.png"
)
```

```{r}
#| label: transportation-stimuli
# Chart 1: Lollipop - Commute time
create_lollipop_chart(
  data = transportation_data,
  category_col = transportation_method,
  value_col = commute_time_minutes,
  title = "Commute Time by Transportation Method",
  y_label = "Time\n(minutes)",
  y_break_interval = 10,
  color = "#8d5b69",
  output_file = "kelly-stimuli-pngs/transport_lollipop.png"
)

create_bar_chart(
  data = transportation_data,
  category_col = transportation_method,
  value_col = commute_time_minutes,
  title = "Commute Time by Transportation Method",
  y_label = "Time\n(minutes)",
  y_break_interval = 10,
  color = "#8d5b69",
  output_file = "kelly-stimuli-pngs/transport_bar1.png"
)

# Chart 2: Bar - Weekly cost
create_bar_chart(
  data = transportation_data,
  category_col = transportation_method,
  value_col = weekly_cost,
  title = "Weekly Cost by Transportation Method",
  y_label = "Cost\n(Dollars)",
  y_break_interval = 10,
  color = "#8d5b69",
  output_file = "kelly-stimuli-pngs/transport_bar.png"
)

# Chart 3: Dot - Distance
create_dot_plot(
  data = transportation_data,
  category_col = transportation_method,
  value_col = distance_miles,
  title = "Distance Traveled by Transportation Method",
  y_label = "Distance\n(miles)",
  y_break_interval = 2,
  color = "#8d5b69",
  output_file = "kelly-stimuli-pngs/transport_dot.png"
)

create_bar_chart(
  data = transportation_data,
  category_col = transportation_method,
  value_col = distance_miles,
  title = "Distance Traveled by Transportation Method",
  y_label = "Distance\n(miles)",
  y_break_interval = 2,
  color = "#8d5b69",
  output_file = "kelly-stimuli-pngs/transport_bar3.png"
)
```

```{r}
#| label: gaming-stimuli

gaming_order <- c("Mobile", "Console", "PC", "VR", "Handheld")

# Chart 1: Lollipop - Weekly players
create_lollipop_chart(
  data = gaming_data,
  category_col = gaming_platform,
  value_col = weekly_players_millions,
  title = "Average Number of Weekly Players by Video Game Type",
  y_label = "Number of \nPlayers (millions)",
  category_order = gaming_order,
  y_break_interval = 100,
  color = "#8E7D9B",
  output_file = "kelly-stimuli-pngs/gaming_lollipop.png"
)

create_bar_chart(
  data = gaming_data,
  category_col = gaming_platform,
  value_col = weekly_players_millions,
  title = "Average Number of Weekly Players by Video Game Type",
  y_label = "Number of \nPlayers (millions)",
  category_order = gaming_order,
  y_break_interval = 100,
  color = "#8E7D9B",
  output_file = "kelly-stimuli-pngs/gaming_bar1.png"
)

# Chart 2: Dot - Avg session minutes
create_dot_plot(
  data = gaming_data,
  category_col = gaming_platform,
  value_col = avg_session_minutes,
  title = "Average Playing Time per Session by Video Game Type",
  y_label = "Playing time\n(minutes)",
  category_order = gaming_order,
  y_break_interval = 20,
  color = "#8E7D9B",
  output_file = "kelly-stimuli-pngs/gaming_dot.png"
)

create_bar_chart(
  data = gaming_data,
  category_col = gaming_platform,
  value_col = avg_session_minutes,
  title = "Average Playing Time per Session by Video Game Type",
  y_label = "Session Length\n(minutes)",
  category_order = gaming_order,
  y_break_interval = 20,
  color = "#8E7D9B",
  output_file = "kelly-stimuli-pngs/gaming_bar2.png"
)

# Chart 3: Bar - Monthly spending
create_bar_chart(
  data = gaming_data,
  category_col = gaming_platform,
  value_col = monthly_spending,
  title = "Average Monthly Game Spending by Video Game Type",
  y_label = "Spending\n(dollars)",
  category_order = gaming_order,
  y_break_interval = 20,
  color = "#8E7D9B",
  output_file = "kelly-stimuli-pngs/gaming_bar.png"
)
```

```{r}
#| label: meals-stimuli

meals_order <- c("Breakfast", "Lunch", "Dinner", "Snacks", "Dessert")

# Chart 1: Dot - Prep time
create_dot_plot(
  data = meals_data,
  category_col = meal_type,
  value_col = prep_time_minutes,
  title = "Average Preparation Time by Meal Type",
  y_label = "Prep Time\n(minutes)",
  category_order = meals_order,
  y_break_interval = 10,
  color = "#394c61",
  output_file = "kelly-stimuli-pngs/meals_dot.png"
)

create_bar_chart(
  data = meals_data,
  category_col = meal_type,
  value_col = prep_time_minutes,
  title = "Average Preparation Time by Meal Type",
  y_label = "Prep Time\n(minutes)",
  category_order = meals_order,
  y_break_interval = 10,
  color = "#394c61",
  output_file = "kelly-stimuli-pngs/meals_bar1.png"
)

# Chart 2: Bar - Cost per serving
create_bar_chart(
  data = meals_data,
  category_col = meal_type,
  value_col = cost_per_serving,
  title = "Average Cost per Serving by Meal Type",
  y_label = "Cost per\nServing ($)",
  category_order = meals_order,
  y_break_interval = 2,
  color = "#394c61",
  output_file = "kelly-stimuli-pngs/meals_bar.png"
)

# Chart 3: Lollipop - Servings per week
create_lollipop_chart(
  data = meals_data,
  category_col = meal_type,
  value_col = servings_per_week,
  title = "Average Servings per Week by Meal Type",
  y_label = "Servings\nper Week",
  category_order = meals_order,
  y_break_interval = 2,
  color = "#394c61",
  output_file = "kelly-stimuli-pngs/meals_lollipop.png"
)

create_bar_chart(
  data = meals_data,
  category_col = meal_type,
  value_col = servings_per_week,
  title = "Average Servings per Week by Meal Type",
  y_label = "Servings\nper Week",
  category_order = meals_order,
  y_break_interval = 2,
  color = "#394c61",
  output_file = "kelly-stimuli-pngs/meals_bar3.png"
)
```
